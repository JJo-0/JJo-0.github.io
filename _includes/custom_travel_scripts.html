<script>
    const navLinks = document.querySelectorAll('nav a.nav-link, #mobile-menu a.nav-link');
    const sections = document.querySelectorAll('main section');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    function updateActiveLink() {
        let currentSectionId = 'introduction';
        sections.forEach(section => {
            const sectionTop = section.offsetTop - 100; // Adjust for sticky header
            if (window.scrollY >= sectionTop) {
                currentSectionId = section.id;
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + currentSectionId) {
                link.classList.add('active');
            }
        });
    }
    
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                window.scrollTo({
                    top: targetSection.offsetTop - 80, // Adjust for sticky header
                    behavior: 'smooth'
                });
            }
            // For mobile menu, close after click
            if (mobileMenu.classList.contains('block')) {
                mobileMenu.classList.remove('block');
                mobileMenu.classList.add('hidden');
            }
        });
    });
    
    window.addEventListener('scroll', updateActiveLink);
    window.addEventListener('load', updateActiveLink); // Initial active link

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        mobileMenu.classList.toggle('block');
    });

    // 향상된 여행 프롬프트 스크립트
    document.addEventListener('DOMContentLoaded', function() {
        // 아코디언 기능
        const accordionButtons = document.querySelectorAll('.accordion-button');
        accordionButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId);
                
                // 부드러운 전환 효과 추가
                if(content.classList.contains('hidden')) {
                    content.style.maxHeight = "0";
                    content.style.opacity = "0";
                    content.classList.remove('hidden');
                    
                    // 다음 프레임에서 전환 실행
                    setTimeout(() => {
                        content.style.maxHeight = content.scrollHeight + "px";
                        content.style.opacity = "1";
                    }, 10);
                } else {
                    content.style.maxHeight = "0";
                    content.style.opacity = "0";
                    
                    // 전환 효과 완료 후 hidden 클래스 추가
                    setTimeout(() => {
                        content.classList.add('hidden');
                    }, 300);
                }
                
                // 버튼 토글 스타일
                this.classList.toggle('active');
            });
        });
        
        // 페르소나 선택기
        const personaSelect = document.getElementById('persona-select');
        const selectedPersonaOutput = document.getElementById('selected-persona-output');
        
        if(personaSelect && selectedPersonaOutput) {
            personaSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                selectedPersonaOutput.textContent = selectedOption.textContent;
                
                // 선택 애니메이션
                selectedPersonaOutput.classList.add('text-sky-600');
                setTimeout(() => {
                    selectedPersonaOutput.classList.remove('text-sky-600');
                }, 500);
            });
        }

        // CoT 버튼 및 단계 표시
        const cotRevealButton = document.getElementById('cot-reveal-button');
        const cotSteps = document.getElementById('cot-steps');
        
        if(cotRevealButton && cotSteps) {
            cotRevealButton.addEventListener('click', function() {
                if(cotSteps.classList.contains('hidden')) {
                    cotSteps.classList.remove('hidden');
                    cotSteps.style.maxHeight = "0";
                    cotSteps.style.opacity = "0";
                    
                    // 다음 프레임에서 전환 실행
                    setTimeout(() => {
                        cotSteps.style.maxHeight = cotSteps.scrollHeight + "px";
                        cotSteps.style.opacity = "1";
                    }, 10);
                    
                    this.textContent = "CoT 단계 숨기기";
                    this.classList.add('bg-sky-700');
                } else {
                    cotSteps.style.maxHeight = "0";
                    cotSteps.style.opacity = "0";
                    
                    // 전환 효과 완료 후 hidden 클래스 추가
                    setTimeout(() => {
                        cotSteps.classList.add('hidden');
                    }, 300);
                    
                    this.textContent = "CoT 단계 보기 (개념적)";
                    this.classList.remove('bg-sky-700');
                }
            });
        }
        
        // 제약 조건 차트 초기화 (ChartJS 사용)
        const constraintsImpactChart = document.getElementById('constraintsImpactChart');
        if(constraintsImpactChart) {
            new Chart(constraintsImpactChart, {
                type: 'line',
                data: {
                    labels: ['없음', '기본', '세부', '매우 구체적'],
                    datasets: [{
                        label: '계획 관련성',
                        data: [20, 45, 75, 95],
                        borderColor: 'rgb(14, 165, 233)',
                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '계획 품질/관련성'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '프롬프트 제약 조건 상세도'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `관련성: ${context.parsed.y}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 프레임워크 비교 차트 초기화
        const frameworksComparisonChart = document.getElementById('frameworksComparisonChart');
        if(frameworksComparisonChart) {
            new Chart(frameworksComparisonChart, {
                type: 'radar',
                data: {
                    labels: [
                        '제약 조건 처리',
                        '실시간 정보 활용',
                        '내러티브 생성 능력',
                        '루트 최적화',
                        '적응형 계획 수정'
                    ],
                    datasets: [
                        {
                            label: 'TRIP-PAL',
                            data: [90, 70, 50, 85, 65],
                            fill: true,
                            backgroundColor: 'rgba(14, 165, 233, 0.2)',
                            borderColor: 'rgb(14, 165, 233)',
                            pointBackgroundColor: 'rgb(14, 165, 233)'
                        },
                        {
                            label: 'NarrativeGuide',
                            data: [65, 60, 95, 75, 60],
                            fill: true,
                            backgroundColor: 'rgba(236, 72, 153, 0.2)',
                            borderColor: 'rgb(236, 72, 153)',
                            pointBackgroundColor: 'rgb(236, 72, 153)'
                        },
                        {
                            label: 'FLEX-TRAVELPLANNER',
                            data: [75, 80, 65, 70, 90],
                            fill: true,
                            backgroundColor: 'rgba(34, 197, 94, 0.2)',
                            borderColor: 'rgb(34, 197, 94)',
                            pointBackgroundColor: 'rgb(34, 197, 94)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        // 스크롤 애니메이션 개선
        const contentSections = document.querySelectorAll('.content-section');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                // 요소가 화면에 보이면 애니메이션 클래스 추가
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in');
                    observer.unobserve(entry.target); // 한 번만 애니메이션 적용
                }
            });
        }, {
            threshold: 0.1 // 10% 이상 보이면 애니메이션 시작
        });
        
        // 모든 콘텐츠 섹션에 관찰자 적용
        contentSections.forEach(section => {
            observer.observe(section);
        });
    });

    // CSS 전환을 위한 스타일 추가
    document.head.insertAdjacentHTML('beforeend', `
        <style>
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }
        .accordion-content:not(.hidden) {
            overflow: visible;
        }
        </style>
    `);
</script>
